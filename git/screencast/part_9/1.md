При слиянии двух веток создается новый коммит, который представляет новое состояние проекта, содержащее изменения из обоих веток.  

Алгоритм слияния сначала найдет где ветки разделились, т.е. общий коммит-предок для обоих веток. Для определения коммита-предка есть команда:  

                                                git merge-base branch_1 branch_2  

Дальше для каждого файла сравниваются 3 версии:  
 - первая - которая была в их общем предке(base)
 - вторая - которая на текущей ветке(ours)
 - третья - theirs - сливаемая версия  

Git берет базовую версию за основу и добавляет в нее изменения из нашей и сливаемой версии:  

                                         base + (our changes) + (their changes) -> merge  

Таким образом получаем новую версию файла с изменениями, которые внесены в обоих ветках. Если поменяли файл в одном и том же месте по-разному - конфликт.  

Прерванное слияние - состояние при конфликте. 

Git запоминает коммит с которым мы осуществляем слияние в файле .git/MERGE_HEAD (т.е. если сливаем ветку feature в master то это тот коммит который был последним в feature)  

Если в одной из веток файл менялся, а в другой нет, то в результат слияния попадут более новые изменения.  

![img_1](https://user-images.githubusercontent.com/35499834/46913104-5184ea80-cf87-11e8-8867-20da76c04013.png)

Чтобы отменить процесс слияния:  
**git reset --hard** - прекратит слияние и очистит все незакоммиченные изменения включая конфликты.  

**git reset --merge** - оставляет незакоммиченные изменения в файлах, которые не участвовали в слиянии. **git merge --abort** - тоже самое но его проще запомнить.  

**git checkout --conflict=diff3 --merge <file_name>** - в редакторе будут поля ours, theirs, base  

Чтобы всегда представлялось 3 части слияния - добавим настройку конфигурации:  

                                                git config --global merge.conflictStyle diff3  

Чтобы завершить слияние, нужно сделать коммит:  

        git commit
           или
        git merge --continue  

Коммит слияния имеет два родителя, в этом можно убедиться:  

                                                git log --oneline --all --graph  
                                                git show  

При вызове git show будет выведена информация о коммите и указаны родители коммита Merge: 935650a 1b5217c  

**git branch --merged** - показывает ветки, объединенные с текущей.  

**Отмена слияния**  
Т.е. нужно отменить коммит слияния. Не смотря на то что у него 2 родителя, этот коммит находится только в одной ветке. Т.е. сделать:  

                                                git reset --hard @~

Семантические конфликты.  

**git merge <branch_2> --no-commit** - чтобы git сделал слияние, добавил все в Index, но остановился перед коммитом, т.е. перейдем в состояние прерванного слияния.  

**git merge --squash** - берет изменения из ветки...

При использовании --squash не создается MERGE_HEAD  

**Стратегии слияния**  
У слияния есть несколько алгоритмов, которые называются стратегиями сливания. Стратегия по умолчанию - recursive. Она предварительно осуществляет слияние обоих родителей 'виртуального предка'  

У рекурсивной стратегии есть несколько опций, позволяющих задавать поведение при конфликте:  
 - ours - все конфликты будут разрешены в нашу пользу
 - theirs - противоположна ours  

Опции задаются:  

                                        git merge -Xours <commit>
                                        git merge -Xtheirs <commit>

 - renormalize - нормализует концы строк
 - ignore-all-space - для работы с пробелами(кто-то использует пробелы а кто-то табы) т.е. с этой опцией можно игнорировать различия в пробелах.  
 - no-renames