### Сохранение данных на стороне клиента

Веб-приложения могут использовать прикладные программные интерфейсы броузеров для сохранения данных локально,
на компьютере пользователя. Этот механизм сохранения данных на стороне клиента выполняет роль памяти для веб-броузеров.

Хранилище на стороне клиента разграничивает данные в соответствии с происхождением, поэтому страницы с одного
сайта не смогут читать данные, сохраненные страницами с другого сайта. Но две страницы с одного и того же сайта
смогут использовать хранилище в качестве механизма взаимодействий.

Существует несколько разновидностей хранилищ на стороне клиента:
 * Web Storage – это прикладной программный интерфейс, он содержит объекты localStorage и sessionStorage, которые,
   по сути, являются постоянно хранимыми ассоциативными массивами, отображающими ключи в строковые значения.
 * Cookies
 * Offline Web Applications - Стандарт HTML5 определяет прикладной программный интерфейс, позволяющий кэшировать
   веб-страницы и связанные с ними ресурсы (сценарии, CSS-файлы, изображения) Это хранилище предназначено для сохранения веб-приложений целиком, а не только их данных, и давая возможность использовать их даже при отсутствии соединения с Интернетом.

### Объекты localStorage и sessionStorage
Оба свойства ссылаются на объект Storage – постоянно хранимый ассоциативный массив. Объекты Storage действуют
подобно обычным объектам в языке JavaScript: достаточно просто присвоить свойству объекта строку, и броузер
автоматически сохранит ее.

Однако на момент написания этих строк броузеры позволяли сохранять только строки. Если потребуется сохранять и извлекать данные других типов, их можно кодировать и декодировать вручную. Например:

                                // При сохранении числа оно автоматически преобразуется в строку.
                                // Не забудьте выполнить обратное преобразование при извлечении из хранилища.
                                localStorage.x = 10;
                                var x = parseInt(localStorage.x);

                                localStorage.data = JSON.stringify(data); // Закодировать и сохранить
                                var data = JSON.parse(localStorage.data); // Извлечь и декодировать.

Объекты localStorage и sessionStorage отличаются сроком хранения данных и областью видимости хранилища. Объект
localStorage представляет долговременное хранилище данных: срок хранения не ограничен, и данные сохраняются
на компьютере пользователя, пока не будут удалены веб-приложением или пока пользователь не потребует от броузера удалить их.

Доступность данных в объекте localStorage ограничивается происхождением документа. происхождение документа определяется такими параметрами, как протокол, имя хоста и номер порта, поэтому все следующие URL-адреса ссылаются
на документы с разным происхождением:

                                        http://www.example.com // Протокол: http; имя хоста: www.example.com
                                        https://www.example.com // Другой протокол
                                        http://static.example.com // Другое имя хоста
                                        http://www.example.com:8000 // Другой порт

Все документы, имеющие одно и то же происхождение, будут совместно использовать одни и те же данные в объекте
localStorage (независимо от происхождения сценария, который фактически обращается к хранилищу localStorage). Они смогут читать и изменять данные друг друга.

Но документы с разными происхождениями никогда не смогут прочитать или изменить данные друг друга (даже если оба они будут выполнять сценарий, полученный с одного и того же стороннего сервера).

видимость данных в хранилище localStorage также ограничивается конкретным броузером. Если посетить сайт с помощью
Firefox, а затем вновь посетить его, например, с помощью Chrome, никакие данные, сохраненные при первом посещении,
не будут доступны при втором посещении.

Данные, сохраняемые в sessionStorage, имеют другой срок хранения: они хранятся, пока остается открытым окно
верхнего уровня или вкладка броузера, в которой выполнялся сценарий, сохранивший эти данные. При закрытии окна
или вкладки все данные, хранящиеся в sessionStorage, удаляются.

Доступность данных в хранилище sessionStorage, как и в хранилище localStorage, ограничивается происхождением
документа. Но помимо этого доступность данных в хранилище sessionStorage ограничивается также окном. Если пользователь
откроет в броузере две вкладки, отображающие документы с общим происхождением, эти две вкладки будут владеть разными
хранилищами sessionStorage. Сценарий, выполняющийся в одной вкладке, не сможет прочитать или изменить данные, сохраненные в другой вкладке, даже если в обеих вкладках будет открыта одна и та же страница и будет выполняться
один и тот же сценарий. Разграничение хранилищ sessionStorage в разных окнах касается только окон верхнего уровня. Если в одной вкладке броузера будет находиться несколько элементов <iframe> и в этих фреймах будут отображаться документы с общим происхождением, они будут совместно использовать одно и то же хранилище sessionStorage.

### Прикладной программный интерфейс объекта Storage
Объекты localStorage и sessionStorage часто используются как обычные объекты языка JavaScript: присваивание значения
свойству приводит к сохранению строки, а чтение свойства – к ее извлечению из хранилища.
Но эти объекты определяют также более формальный прикладной интерфейс:
 * сохранить значение можно с помощью метода setItem(), передав ему имя и значение.
 * Извлечь значение можно с помощью метода getItem(), передав ему имя.
 * Удалить значение можно с помощью метода removeItem(), передав ему имя. 
 * Удалить все хранящиеся значения можно вызовом метода clear() (без аргументов).
 * перечислить имена всех хранящихся значений можно с помощью свойства length
   и метода key(), передавая ему значения от 0 до length-1

                                    localStorage.setItem("x", 1); // Сохранить число под именем "x"
                                    localStorage.getItem("x"); // Извлечь значение

                                    // Перечислить все хранящиеся пары имя-значение
                                    for(var i = 0; i < localStorage.length; i++) { // length дает количество пар
                                    var name = localStorage.key(i); // Получить имя i-й пары
                                    var value = localStorage.getItem(name); // Получить значение этой пары
                                    }

                                    localStorage.removeItem("x"); // Удалить элемент "x"
                                    localStorage.clear(); // Удалить все остальные элементы

### События объекта Storage
При изменении данных, хранящихся в localStorage или sessionStorage, броузер генерирует событие «storage» во всех объектах Window, в которых доступны эти данные (но не в окне, где выполнялось сохранение!!!). Если в броузере
открыты две вкладки со страницами с общим происхождением и в одной из страниц производится сохранение значения
в localStorage, в другой вкладке будет сгенерировано событие «storage».

При изменении данных в sessionStorage события «storage» будут генерироваться только при наличии нескольких фреймов.
События «storage» генерируются, только когда содержимое хранилища действительно изменяется. Присваивание хранимому
элементу его текущего значения, как и попытка удалить несуществующий элемент, не возбуждают событие.

Регистрация обработчиков события «storage» выполняется с помощью метода addEventListener() (или attachEvent() в IE). Для этой цели можно также использовать свойство onstorage объекта Window.

Объект события, связанный с событием «storage», имеет пять основных свойств:
 * key - имя или ключ сохраняемого или удаляемого элемента. Если был вызван метод clear(), это свойство будет
   иметь значение null.
 * newValue - Новое значение элемента или null, если был вызван метод removeItem().
 * oldValue - Старое значение существующего элемента, изменившегося или удаленного, или значение null, если был создан
   новый элемент. 
 * storageArea - Это свойство будет хранить значение свойства localStorage или sessionStorage целевого объекта Window.
 * url - URL-адрес (в виде строки) документа, сценарий которого выполнил операцию с хранилищем.